function sharelink_init(e){e.tooltipsy({alignTo:"element",offset:[-1,0],showEvent:"click",hideEvent:"click",show:function(e,t){var n=$(e.currentTarget);t.css({position:"absolute",top:n.offset().top+25+"px",left:n.offset().left+n.width()-162+"px"}).fadeIn(200),n.addClass("open")},hide:function(e,t){$(e.currentTarget);$(e.currentTarget).removeClass("open"),t.fadeOut(200)},content:function(e){var t="",n=e.prop("href").match(/#p(\d+)$/)[1];return $.each(["facebook","vkontakte","odnoklassniki","mailru","twitter","linkedin","reddit","tumblr"],(function(e,i){t+='<a class="social social-'+i+'" href="/share.php?p='+i+"&amp;pid="+n+'" target="_blank" title="'+i+'"></a>'})),'<div class="post-share-tip"><div class="post-share-legend"><span>'+FORUM.get("topic.language.share_legend")+'</span></div><div class="post-share-icons">'+t+"</div></div>"},css:{background:"rgba(0,0,0,0.8)","border-radius":"3px"}})}function toggleSpoiler(e){var t=$(e).siblings("script"),n=$(e).next("blockquote");t.length&&(n.html(t.text()),t.remove(),$(e).parent(".spoiler-box").trigger($.Event("spoiler.firstOpen",{sender:e}))),$(e).toggleClass("visible"),n.toggleClass("visible"),$(e).parent(".spoiler-box").trigger($.Event("spoiler.toggle",{sender:e}))}FORUM.PartnerVote=function(e,t){return!0},$((function(){$(".topic div.post-vote, .topic li.pa-respect").find('a[href*="relation.php?"]').on("click",(function(e){e.preventDefault();var t=$(this).prop("href"),n=t.match(/\?id=(\d+)/)[1],i=$(this).parents(".post").find('.pl-email a[href*="profile.php?"]').prop("href");i&&(i=i.match(/\?id=(\d+)$/)[1]);var r=0==t.match(/&v=(\d+)/)[1]?-1:1;$("#post-"+n+"-vote").hide(),FORUM.PartnerVote(n,r)&&$.get(t+"&format=json",(function(e){if(e.error&&e.error.message&&$.jGrowl(e.error.message),e.delta){var t=e.response;t>0&&(t="+"+t.toString()),$("#p"+n+" .post-rating a").text(t);var o=$('.pl-email a[href$="profile.php?id='+i+'"]').parents(".post").find(".pa-respect"),a=$('.pl-email a[href$="profile.php?id='+UserID+'"]').parents(".post").find(".pa-positive");function s(e,t,n){var i=$(e).html(),r=t;n&&(r=r>0?-1:1),i=t>0?i.replace(/\[\+(\d+)\//g,(function(e,t,n,i){return"[+"+(parseInt(t)+r)+"/"})):i.replace(/\/-(\d+)\]/g,(function(e,t,n,i){return"/-"+(parseInt(t)-r)+"]"})),$(e).html(i)}if(-1!=o.html().indexOf("["))o.each((function(){s(this,r)})),a.each((function(){s(this,r)})),2==Math.abs(e.delta)&&(r=r>0?-1:1,o.each((function(){s(this,r,1)})),a.each((function(){s(this,r,1)})));else{var p=o.find("span:not(.fld-name)").html(),l=a.find("span:not(.fld-name)").html(),c=parseInt(p)+r;if(l)var f=parseInt(l)+r;c&&c>0&&(c="+"+c),f&&f>0&&(f="+"+f),o.find("span:not(.fld-name)").html(c),l&&a.find("span:not(.fld-name)").html(f)}}}))}))})),$((function(){sharelink_init($(".topic .sharelink"));var e=!1;$("body").on("click",".post-share-tip",(function(t){e=!0,setTimeout((function(){e=!1}),20)})).on("click",(function(){!e&&$(".post-share-tip:visible").length&&$(".topic .sharelink.open").trigger("click")}))}));